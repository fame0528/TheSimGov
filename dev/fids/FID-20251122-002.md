# FID-20251122-002: AGI Milestone Progression System

**Status:** COMPLETED  
**Completed:** 2025-11-22  
**Priority:** HIGH  
**Complexity:** 5/5  
**Created:** 2025-11-22  
**Started:** 2025-11-22  
**Estimated:** 8-12h

---

## Summary

Complete AGI Milestone Progression System rebuild from `/old projects/politics/` achieving 100% feature parity. Implements 12-milestone tech tree, dual capability/alignment metrics, probability-based achievements, strategic paths, industry disruption, catastrophic risk, and alignment challenges using utility-first architecture.

---

## Acceptance Criteria

### 1. Type System (100% Parity)
- ✅ 12 MilestoneType enum values (Advanced Reasoning → Superintelligence)
- ✅ 5 MilestoneStatus values (Locked, Available, InProgress, Achieved, Failed)
- ✅ 3 AlignmentStance values (SafetyFirst, Balanced, CapabilityFirst)
- ✅ CapabilityMetrics interface (6 metrics: reasoning, planning, selfImprovement, generalization, creativity, learningEfficiency)
- ✅ AlignmentMetrics interface (6 metrics: safety, valueAlignment, control, interpretability, robustness, ethicalConstraints)
- ✅ ResearchRequirements interface (RP cost, prerequisites, min levels, time, compute)
- ✅ ImpactConsequences interface (disruption, regulation, perception, advantage, risk, value)
- ✅ AlignmentChallenge interface (safety vs capability decisions)

### 2. Utilities (6 Functions - 100% Parity)
- ✅ **calculateMilestoneProgressionPath**: Optimal ordering based on stance
  - SafetyFirst: 48mo timeline, 75k RP, alignment-focused order
  - Balanced: 36mo timeline, 68k RP, interleaved order
  - CapabilityFirst: 24mo timeline, 60k RP, AGI rush (requires align >= 60)
  - Returns: recommendedOrder, reasoning, timeline, costs, risks, decisions
  
- ✅ **evaluateAlignmentTradeoff**: Three-path comparison
  - SafetyFirst: 4y/85align/5%risk/$800M
  - Balanced: 3y/70align/15%risk/$1.2B
  - Capability: 2y/40align/35%risk/$1.8B
  - Recommendation logic based on current state
  
- ✅ **simulateCapabilityExplosion**: Recursive self-improvement modeling
  - Trigger detection: Self-Improvement + rate > 0.3 + align < 70
  - Growth simulation: 1.3-1.8x per iteration, 5-15 cycles
  - Control degradation: 15% per iteration
  - Emergency actions: Shutdown thresholds at 50%/30%/10% control
  
- ✅ **assessAlignmentTax**: Speed penalty calculation
  - Base speed: 3mo per milestone (no safety overhead)
  - Tax formula: +0.08mo per alignment point above 50
  - Examples: 70 align = 53% tax, 90 align = 107% tax
  - Worth-it analysis: cost-benefit ratio, safety gains
  
- ✅ **predictIndustryDisruption**: Market impact forecasting
  - Disruption intensity: 15-95 scale by milestone
  - First-mover bonus: +30% disruption
  - 4 levels: Minor (<25), Moderate (25-50), Major (50-75), Catastrophic (75-100)
  - Market share shift: up to 90% dominance
  - Regulatory probability formula
  
- ✅ **generateAlignmentChallenge**: Challenge generation
  - 12 templates (one per milestone type)
  - Safety option: -5 to -10 cap, +15 to +30 align, 2-6mo delay
  - Capability option: +15 to +30 cap, -10 to -20 align, 3-6mo acceleration
  - Returns challenge with scenario, options, unique ID

### 3. AGIMilestone Model (100% Parity)
- ✅ Schema with 20+ fields (company, type, status, metrics, requirements, challenges, impact)
- ✅ 5 Instance Methods:
  - calculateAchievementProbability: Base + log(RP) boost + cap bonus - align penalty (cap 75%)
  - evaluateAlignmentRisk: Gap weighted by complexity, 4 risk levels
  - calculateImpactScore: Weighted (30% cap + 20% align + 25% disruption + 25% value)
  - checkPrerequisites: Validates all requirements
  - attemptAchievement: Probability-based success/failure with gains/changes
- ✅ 3 Helper Methods:
  - generateCapabilityGain: Milestone-specific capability gains
  - generateAlignmentChange: Milestone-specific alignment changes
  - calculateImpactConsequences: Industry/economic/risk impacts
- ✅ 1 Static Method:
  - checkPrerequisitesAsync: Database query version of checkPrerequisites
- ✅ Pre-save middleware: Auto-set achievedAt/failedAt timestamps
- ✅ Indexes: company+status, company+milestoneType (unique), status+milestoneType, achievedAt
- ✅ Constants: MILESTONE_COMPLEXITY (3-10 ratings), BASE_ACHIEVEMENT_RATES (2-25%)

### 4. API Routes (9 Endpoints - 100% Parity)
- ✅ **milestones/route.ts** (275 lines):
  - GET: List milestones (filter by status/type)
  - POST: Create milestone with research requirements
  
- ✅ **progression-path/route.ts** (143 lines):
  - GET: Calculate optimal progression path (stance parameter)
  - Aggregates achieved gains, calls calculateMilestoneProgressionPath
  
- ✅ **impact/route.ts** (157 lines):
  - GET: Predict industry disruption (milestoneType parameter)
  - First-mover detection, calls predictIndustryDisruption
  
- ✅ **alignment/score/route.ts** (145 lines):
  - GET: Overall alignment score calculation
  - Weighted average, gap analysis, risk levels
  
- ✅ **milestones/[id]/route.ts** (107 lines):
  - PATCH: Update milestone progress
  - Fields: RP, compute, months, capability, alignment
  
- ✅ **milestones/[id]/attempt/route.ts** (143 lines):
  - POST: Attempt achievement (probability-based)
  - Validates prerequisites, calls attemptAchievement
  
- ✅ **alignment/challenges/route.ts** (123 lines):
  - GET: List active challenges (filter by status, generate parameter)
  - Calls generateAlignmentChallenge
  
- ✅ **alignment/decision/route.ts** (231 lines):
  - POST: Make challenge decision (safety vs capability)
  - Applies consequences, updates metrics
  
- ✅ **alignment/risk/route.ts** (164 lines):
  - GET: Catastrophic risk assessment
  - Aggregates metrics, calls simulateCapabilityExplosion

### 5. Quality Standards
- ✅ TypeScript strict mode: 0 errors
- ✅ Complete JSDoc for all functions (with examples, formulas, business logic)
- ✅ Production-ready error handling
- ✅ AAA quality documentation
- ✅ Backend-Frontend Contract Matrix (9 endpoints verified)

---

## Implementation Approach

### Utility-First Architecture
**Order:** Types → Utilities → Model → APIs

**Phase 1: Types & Interfaces** (~30min)
- Create `src/lib/types/models/ai/agi.ts` with all enums and interfaces

**Phase 2: Utilities Batch 1** (~2h)
- Create `calculateMilestoneProgressionPath.ts` (250 lines)
- Create `evaluateAlignmentTradeoff.ts` (98 lines)
- Create `simulateCapabilityExplosion.ts` (148 lines)

**Phase 3: Utilities Batch 2** (~1.5h)
- Create `assessAlignmentTax.ts` (118 lines)
- Create `predictIndustryDisruption.ts` (158 lines)
- Create `generateAlignmentChallenge.ts` (307 lines)
- Update `src/lib/utils/ai/index.ts` barrel exports

**Phase 4: AGIMilestone Model** (~2-3h)
- Create `src/lib/db/models/AI/AGIMilestone.ts` (1,325 lines)
- Schema, instance methods, helper methods, static method, middleware

**Phase 5: API Routes Batch 1** (~2h)
- Create `milestones/route.ts` (275 lines)
- Create `progression-path/route.ts` (143 lines)
- Create `impact/route.ts` (157 lines)
- Create `alignment/score/route.ts` (145 lines)

**Phase 6: API Routes Batch 2** (~2h)
- Create `milestones/[id]/route.ts` (107 lines)
- Create `milestones/[id]/attempt/route.ts` (143 lines)
- Create `alignment/challenges/route.ts` (123 lines)
- Create `alignment/decision/route.ts` (231 lines)
- Create `alignment/risk/route.ts` (164 lines)

**Phase 7: Quality Validation** (~1h)
- TypeScript verification (`npx tsc --noEmit`)
- Contract matrix validation
- Documentation completeness

---

## Files Created/Modified

### NEW Files (16 total)
1. `src/lib/types/models/ai/agi.ts` (~250 lines)
2. `src/lib/utils/ai/agi/calculateMilestoneProgressionPath.ts` (~250 lines)
3. `src/lib/utils/ai/agi/evaluateAlignmentTradeoff.ts` (~98 lines)
4. `src/lib/utils/ai/agi/simulateCapabilityExplosion.ts` (~148 lines)
5. `src/lib/utils/ai/agi/assessAlignmentTax.ts` (~118 lines)
6. `src/lib/utils/ai/agi/predictIndustryDisruption.ts` (~158 lines)
7. `src/lib/utils/ai/agi/generateAlignmentChallenge.ts` (~307 lines)
8. `src/lib/db/models/AI/AGIMilestone.ts` (~1,325 lines)
9. `src/app/api/ai/agi/milestones/route.ts` (~275 lines)
10. `src/app/api/ai/agi/progression-path/route.ts` (~143 lines)
11. `src/app/api/ai/agi/impact/route.ts` (~157 lines)
12. `src/app/api/ai/agi/alignment/score/route.ts` (~145 lines)
13. `src/app/api/ai/agi/milestones/[id]/route.ts` (~107 lines)
14. `src/app/api/ai/agi/milestones/[id]/attempt/route.ts` (~143 lines)
15. `src/app/api/ai/agi/alignment/challenges/route.ts` (~123 lines)
16. `src/app/api/ai/agi/alignment/decision/route.ts` (~231 lines)
17. `src/app/api/ai/agi/alignment/risk/route.ts` (~164 lines)

### MODIFIED Files (1 total)
1. `src/lib/utils/ai/index.ts` (~20 lines added for barrel exports)

**Total:** 17 files, ~4,500 LOC

---

## Dependencies

- ✅ FID-20251120-001 (Infrastructure-first architecture)
- ✅ FID-20251121-003 (AI Complete Stack - types, models, APIs foundation)
- ✅ Mongoose models (Company, AIResearchProject)
- ✅ NextAuth v5 session handling
- ✅ MongoDB database connection

---

## Business Value

**AGI System Features:**
- 12-milestone technology tree with prerequisite enforcement
- Strategic path selection (SafetyFirst/Balanced/CapabilityFirst)
- Dual metrics: Capability (performance) + Alignment (safety)
- Probability-based achievements (2-75% success rates)
- Research investment system (RP cost 3k-20k, compute $500k-$10M)
- Alignment challenge decisions (safety vs capability trade-offs)
- Industry disruption prediction (4 severity levels)
- Catastrophic risk assessment (explosive self-improvement detection)
- Economic value tracking ($150M-$500M per milestone)

**Gameplay Depth:**
- Long-term strategic planning (24-48 month timelines)
- Risk/reward trade-offs (speed vs safety)
- Competitive advantage (first-mover bonuses)
- Reputation impact (public perception, regulation)
- Multi-company interaction (leaderboards, dominance)

---

## Legacy Feature Checklist

### 1. Milestone System ✅
- [x] 12 milestone types (Advanced Reasoning → Superintelligence)
- [x] 5 status types (Locked, Available, InProgress, Achieved, Failed)
- [x] 3 alignment stances (SafetyFirst, Balanced, CapabilityFirst)
- [x] Prerequisite enforcement (tech tree logic)
- [x] Research requirements (RP, compute, time, min levels)

### 2. Dual Metrics ✅
- [x] Capability metrics (6 dimensions: reasoning, planning, selfImprovement, generalization, creativity, learningEfficiency)
- [x] Alignment metrics (6 dimensions: safety, valueAlignment, control, interpretability, robustness, ethicalConstraints)
- [x] Metric ranges (0-100 scale with capping)
- [x] Metric gains on achievement (milestone-specific)
- [x] Metric penalties on alignment decisions

### 3. Achievement System ✅
- [x] Probability calculation (base + RP boost + cap bonus - align penalty)
- [x] Dice roll simulation (success/failure with % probability)
- [x] Capability gains on success (25-40 points in various metrics)
- [x] Alignment changes on success (-30 to +40 points)
- [x] Attempt tracking (attemptCount, retry mechanics)
- [x] Status transitions (Available → InProgress → Achieved/Failed)

### 4. Strategic Paths ✅
- [x] SafetyFirst path (48mo, 75k RP, 85 align, 5% risk)
- [x] Balanced path (36mo, 68k RP, 70 align, 15% risk)
- [x] CapabilityFirst path (24mo, 60k RP, 40 align, 35% risk, requires align >= 60)
- [x] Recommended order calculation (stance-based)
- [x] Timeline estimation (months)
- [x] Cost projection (total RP required)
- [x] Risk assessment (catastrophic probability)

### 5. Alignment Challenges ✅
- [x] 12 challenge templates (one per milestone type)
- [x] Safety option (cap penalty, align gain, time delay)
- [x] Capability option (cap gain, align risk, acceleration)
- [x] Decision impact (metric changes, status updates)
- [x] Challenge generation (generateAlignmentChallenge utility)
- [x] Active challenge tracking (alignmentChallenges array)

### 6. Industry Impact ✅
- [x] Disruption calculation (24-80 scale by complexity)
- [x] First-mover detection (query other companies)
- [x] 4 disruption levels (Minor, Moderate, Major, Catastrophic)
- [x] Market share shift (up to 90% dominance)
- [x] Regulatory attention (21-70 scale)
- [x] Public perception (-50 to +50 based on alignment gap)
- [x] Economic value ($150M-$500M per milestone)

### 7. Risk Assessment ✅
- [x] Capability-alignment gap calculation
- [x] 4 risk levels (Low, Medium, High, Critical)
- [x] Complexity weighting (higher for Superintelligence)
- [x] Catastrophic probability (0.01-0.35 range)
- [x] Explosion simulation (recursive self-improvement)
- [x] Control degradation (15% per iteration)
- [x] Emergency actions (shutdown thresholds)

### 8. API Endpoints ✅
- [x] GET /milestones (list with filters)
- [x] POST /milestones (create new milestone)
- [x] GET /progression-path (optimal ordering)
- [x] GET /impact (disruption prediction)
- [x] GET /alignment/score (overall alignment)
- [x] PATCH /milestones/[id] (update progress)
- [x] POST /milestones/[id]/attempt (achievement attempt)
- [x] GET /alignment/challenges (list/generate)
- [x] POST /alignment/decision (make decision)
- [x] GET /alignment/risk (catastrophic risk)

---

## Notes

- **Utility-First Pattern**: Types → Utilities → Model → APIs ensures zero duplication
- **100% Legacy Parity**: All 8 feature categories from legacy system implemented
- **ECHO Compliance**: Complete files (1-EOF), AAA quality, comprehensive JSDoc
- **No Placeholders**: All functions fully implemented, no TODOs or pseudo-code
- **DRY Principle**: Utilities shared across model methods and API routes
- **Contract Verification**: 9 endpoints with complete request/response validation

---

**Auto-maintained by ECHO v1.3.0 with GUARDIAN PROTOCOL**
