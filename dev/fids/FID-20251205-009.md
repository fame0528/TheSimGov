# FID-20251205-009: Interconnected Empire System - Banking as Foundation

**Status:** ✅ COMPLETE (All 5 Phases)
**Priority:** P0 (Critical)
**Complexity:** 5 (Epic)
**Estimated:** 40h
**Created:** 2025-12-05
**Completed:** 2025-12-05

## Phase Progress

| Phase | Scope | Status | Time |
|-------|-------|--------|------|
| 1 | Banking Core Models & API | ✅ COMPLETE | 8h |
| 2 | Synergy Engine Architecture | ✅ COMPLETE | 6h |
| 3 | Banking Gameplay UI | ✅ COMPLETE | 10h |
| 4 | Empire Dashboard & Visualization | ✅ COMPLETE | 8h |
| 5 | Testing & Balancing | ✅ COMPLETE | 8h |

**Note:** This FID was completed BEFORE the Master Plan v2.2 expansion. The new systems documented in v2.2 (100 company types, Core Loop UI, Tick Scheduler, etc.) require additional implementation work (~100h) tracked separately.

## Summary
Build the Banking/Finance industry as the FINANCIAL BACKBONE of an interconnected empire system. Every company type connects to others, creating synergies, dependencies, and compound growth - just like real business empires (Musk, Bezos, etc).

## The Vision: Interconnected Empire Web

```
                                    ┌─────────────┐
                                    │   PLAYER    │
                                    │  (Person)   │
                                    └──────┬──────┘
                                           │ owns
              ┌────────────────────────────┼────────────────────────────┐
              │                            │                            │
       ┌──────▼──────┐              ┌──────▼──────┐              ┌──────▼──────┐
       │   BANKING   │◄────────────►│    MEDIA    │◄────────────►│    TECH     │
       │   Finance   │   loans to   │Social/News  │  ads/data    │  AI/Software│
       └──────┬──────┘              └──────┬──────┘              └──────┬──────┘
              │                            │                            │
              │ finances                   │ influences                 │ automates
              │                            │                            │
       ┌──────▼──────┐              ┌──────▼──────┐              ┌──────▼──────┐
       │ REAL ESTATE │◄────────────►│  POLITICS   │◄────────────►│MANUFACTURING│
       │Land/Property│  lobbying    │ Government  │  contracts   │  Production │
       └──────┬──────┘              └──────┬──────┘              └──────┬──────┘
              │                            │                            │
              │ builds on                  │ regulates                  │ supplies
              │                            │                            │
       ┌──────▼──────┐              ┌──────▼──────┐              ┌──────▼──────┐
       │   ENERGY    │◄────────────►│ HEALTHCARE  │◄────────────►│  LOGISTICS  │
       │Power/Mining │   powers     │Medical/Pharm│  distributes │Transport/WH │
       └─────────────┘              └─────────────┘              └─────────────┘
```

---

## SYNERGY SYSTEM DESIGN

### Core Concept: Every Company Benefits Others

When you own multiple company types, they create **SYNERGIES**:
- **Direct Synergies**: Company A directly helps Company B (bank finances real estate)
- **Indirect Synergies**: Owning A+B unlocks bonus C can't get otherwise
- **Empire Bonuses**: Owning 3+ types in a "chain" creates multipliers

### The Elon Musk Example In Our System:

```
STEP 1: Start with TECH company (like PayPal)
   └── Generates: Cash, Tech expertise, Data

STEP 2: Use cash to start BANKING (like investing)
   └── Synergy: Tech company gets -15% loan rates from own bank
   └── Synergy: Bank gets +20% efficiency from tech automation

STEP 3: Buy MEDIA company (like Twitter)
   └── Synergy: Free advertising for all your companies
   └── Synergy: Bank can advertise financial products to users
   └── Synergy: Tech AI can analyze user data for insights

STEP 4: Expand into MANUFACTURING (like Tesla factories)
   └── Synergy: Bank finances equipment at preferred rates
   └── Synergy: Media promotes products for free
   └── Synergy: Tech provides AI/automation for production

STEP 5: Acquire ENERGY (like solar/batteries)
   └── Synergy: Powers manufacturing at cost (no markup)
   └── Synergy: Bank finances renewable projects
   └── Synergy: Real estate for solar farms

STEP 6: Buy REAL ESTATE (like land for Gigafactories)
   └── Synergy: Build factories on owned land (no rent)
   └── Synergy: Bank holds mortgages, earns interest
   └── Synergy: Energy infrastructure on owned property

STEP 7: Influence POLITICS (lobbying, donations)
   └── Synergy: Favorable regulations for all your industries
   └── Synergy: Government contracts for manufacturing
   └── Synergy: Tax breaks via political connections
```

**RESULT**: Each new company makes ALL existing companies more valuable!

---

## SYNERGY MATRIX

### Banking Synergies (What Banking Provides/Receives)

| Partner Industry | Banking PROVIDES | Banking RECEIVES |
|-----------------|------------------|------------------|
| **Tech/AI** | Loans for R&D, server farms | Automation (-20% operating cost) |
| **Media** | Advertising loans, acquisitions | Free ad space, user data |
| **Real Estate** | Mortgages, development loans | Collateral, branch locations |
| **Energy** | Infrastructure financing | Reduced utility costs |
| **Manufacturing** | Equipment financing, working capital | Payment processing volume |
| **Healthcare** | Medical equipment loans | Employee health plans discount |
| **Logistics** | Fleet financing | Cash transport services |
| **Politics** | Campaign financing | Favorable regulations |

### Synergy Bonuses (Multipliers)

| Combo | Synergy Name | Bonus |
|-------|--------------|-------|
| Bank + Tech | "Fintech Empire" | +25% transaction efficiency |
| Bank + Real Estate | "Property Mogul" | +30% mortgage profits |
| Bank + Media | "Financial Influencer" | +40% customer acquisition |
| Bank + Energy | "Green Finance" | Unlock ESG products, +15% deposits |
| Bank + Manufacturing | "Industrial Banker" | +20% business loan volume |
| Bank + Tech + Media | "Data Goldmine" | AI predicts defaults with 95% accuracy |
| Bank + Real Estate + Energy | "Infrastructure King" | Finance renewable projects, 2x returns |
| ALL Industries | "Total Monopoly" | +100% all profits, political immunity |

---

## RESOURCE FLOW SYSTEM

### Resources Each Industry Produces/Consumes

| Industry | PRODUCES | CONSUMES |
|----------|----------|----------|
| **Banking** | Capital, Loans, Credit | Data, Real Estate, Tech |
| **Tech/AI** | Software, Automation, Data Analytics | Capital, Energy, Talent |
| **Media** | Influence, Ads, User Data | Capital, Content, Tech |
| **Real Estate** | Land, Buildings, Rent | Capital, Materials, Permits |
| **Energy** | Power, Fuel, Heat | Capital, Land, Equipment |
| **Manufacturing** | Products, Jobs | Capital, Energy, Materials, Logistics |
| **Healthcare** | Health Services, Research | Capital, Tech, Real Estate |
| **Logistics** | Transport, Storage | Capital, Energy, Vehicles |
| **Politics** | Laws, Contracts, Influence | Capital (donations), Media support |

### Resource Trading Between Your Companies

When you own multiple companies:
- **Internal Pricing**: Trade resources at COST (no markup)
- **Priority Access**: Your companies get first dibs on limited resources
- **Bundled Deals**: Combine offerings (bank + insurance + real estate)

---

## BANKING AS THE FINANCIAL BACKBONE

### Why Start With Banking?

Banking is the **ENABLER** - it finances everything else:

1. **Capital Provider**: Every other company needs loans to start/grow
2. **Cash Flow Hub**: All your companies' money flows through your bank
3. **Investment Vehicle**: Bank invests in your other companies
4. **Credit Engine**: Provides credit lines during tough times
5. **Acquisition Arm**: Finances hostile takeovers

### Banking-Specific Gameplay (Revised)

**Core Loop** (unchanged):
```
ATTRACT DEPOSITS → MAKE LOANS → COLLECT INTEREST → EXPAND
```

**NEW: Empire Integration Loop**:
```
IDENTIFY SYNERGY → FINANCE ACQUISITION → INTEGRATE COMPANY → HARVEST SYNERGY
         ↑                                                          ↓
         └──────────────── REINVEST PROFITS ←──────────────────────┘
```

### Banking Features for Empire Building

1. **Internal Lending**
   - Loan to your own companies at 0% (cost of capital only)
   - External companies pay full interest
   - Synergy: Tech company pays back with automation upgrade

2. **Acquisition Financing**
   - Special "Takeover Loans" to buy other companies
   - Leverage your existing empire as collateral
   - Hostile takeover mechanics

3. **Cash Management**
   - All your companies' cash consolidates in your bank
   - Earn interest on idle cash
   - Optimize working capital across empire

4. **Investment Banking** (Higher Levels)
   - Take companies public (IPO)
   - Issue bonds for your companies
   - Create financial instruments (derivatives)

---

## EMPIRE PROGRESSION

### Phase 1: Single Company (Levels 1-10)
- Start with ONE company type
- Master the core loop
- Build initial capital

### Phase 2: Vertical Integration (Levels 11-25)
- Acquire companies in your SUPPLY CHAIN
- Example: Bank → Real Estate (need buildings)
- Unlock first synergy bonuses

### Phase 3: Horizontal Expansion (Levels 26-40)
- Acquire companies in ADJACENT industries
- Example: Bank → Tech (automation) → Media (advertising)
- Create compound synergies

### Phase 4: Empire Building (Levels 41-60)
- Own majority of key industries
- Political influence becomes critical
- "Too big to fail" mechanics

### Phase 5: Global Domination (Levels 61+)
- International expansion
- Compete with other player empires
- Shape the entire game economy

---

## TECHNICAL IMPLEMENTATION

### New Systems Required

1. **Synergy Engine**
   - Track which companies player owns
   - Calculate active synergies
   - Apply bonuses/discounts

2. **Resource Flow System**
   - Define resource types
   - Track production/consumption
   - Enable internal trading

3. **Empire Dashboard**
   - Visual web of owned companies
   - Show synergy connections
   - Highlight potential acquisitions

4. **Acquisition System**
   - Browse available companies
   - Valuation calculator
   - Takeover mechanics (hostile/friendly)

### Database Schema Additions

```typescript
// Synergy definition
interface Synergy {
  id: string;
  name: string;
  requiredIndustries: Industry[];
  bonusType: 'percentage' | 'flat' | 'unlock';
  bonusTarget: 'revenue' | 'cost' | 'efficiency' | 'feature';
  bonusValue: number;
  description: string;
}

// Empire tracking
interface PlayerEmpire {
  playerId: string;
  companies: Company[];
  activeSynergies: Synergy[];
  totalValue: number;
  resourceFlows: ResourceFlow[];
}

// Resource flow between companies
interface ResourceFlow {
  fromCompanyId: string;
  toCompanyId: string;
  resourceType: ResourceType;
  quantity: number;
  pricePerUnit: number; // 0 for internal transfers
}
```

---

## IMPLEMENTATION PHASES (Structured Todo List)

### Phase 1: Banking Core Models & API (8h)
- [ ] 1.1 Create Loan mongoose model with all properties
- [ ] 1.2 Create LoanApplicant model (generated customers)
- [ ] 1.3 Create BankDeposit model for customer deposits
- [ ] 1.4 Create BankSettings model (rates, limits, level config)
- [ ] 1.5 API: POST /api/banking/loans (approve loan)
- [ ] 1.6 API: GET /api/banking/loans (list loans)
- [ ] 1.7 API: POST /api/banking/loans/[id]/payment (receive payment)
- [ ] 1.8 API: GET /api/banking/applicants (get pending applicants)
- [ ] 1.9 Interest calculation utility
- [ ] 1.10 Default probability calculator

### Phase 2: Synergy Engine Architecture (6h)
- [ ] 2.1 Create Synergy mongoose model (definitions)
- [ ] 2.2 Create PlayerEmpire model (tracks owned companies)
- [ ] 2.3 Create ResourceFlow model (inter-company transfers)
- [ ] 2.4 Synergy calculation service
- [ ] 2.5 API: GET /api/empire/synergies (active bonuses)
- [ ] 2.6 API: GET /api/empire/companies (owned companies)
- [ ] 2.7 Seed initial synergy definitions

### Phase 3: Banking Gameplay UI (10h)
- [ ] 3.1 Loan Applicants panel (approve/deny workflow)
- [ ] 3.2 Active Loans table with payment tracking
- [ ] 3.3 Deposits management view
- [ ] 3.4 Bank leveling progress display
- [ ] 3.5 Interest rate adjustment controls
- [ ] 3.6 Random event notifications
- [ ] 3.7 Daily bonus/streak UI
- [ ] 3.8 Investment mini-game panel

### Phase 4: Empire Dashboard & Visualization (8h)
- [ ] 4.1 Empire overview page (/game/empire)
- [ ] 4.2 Visual web diagram of owned companies
- [ ] 4.3 Synergy connections display (animated lines)
- [ ] 4.4 Active bonuses sidebar
- [ ] 4.5 Acquisition browser (available companies)
- [ ] 4.6 Resource flow visualization
- [ ] 4.7 Empire statistics (total value, growth rate)

### Phase 5: Testing & Balancing (8h)
- [ ] 5.1 Balance loan economics (interest vs default rates)
- [ ] 5.2 Tune synergy bonus percentages
- [ ] 5.3 Test progression curve (time to each level)
- [ ] 5.4 Verify addiction hooks work (variable rewards)
- [ ] 5.5 Load testing with multiple companies
- [ ] 5.6 TypeScript verification (0 errors)
- [ ] 5.7 Integration testing with existing systems

---

## ACCEPTANCE CRITERIA

- [ ] Player can create a bank and see the dashboard
- [ ] Loan applicants appear with varying credit scores
- [ ] Player can approve/deny loans
- [ ] Interest accrues over time (game tick integration)
- [ ] Loans can default based on credit score probability
- [ ] Bank levels up based on total loans issued
- [ ] Synergy Engine calculates bonuses when owning 2+ companies
- [ ] Empire Dashboard shows owned companies visually
- [ ] Active synergies display with bonus percentages
- [ ] Daily login streak works with multiplied rewards
- [ ] At least 3 random events can occur
- [ ] TypeScript compiles with 0 errors
- [ ] Session length feels engaging (15-30 min target)

---

## FILES

### NEW Files to Create:

| Action | Path | Purpose |
|--------|------|---------|
| NEW | `src/lib/db/models/banking/Loan.ts` | Loan document schema |
| NEW | `src/lib/db/models/banking/LoanApplicant.ts` | Generated applicant schema |
| NEW | `src/lib/db/models/banking/BankDeposit.ts` | Customer deposit schema |
| NEW | `src/lib/db/models/banking/BankSettings.ts` | Bank configuration schema |
| NEW | `src/lib/db/models/empire/Synergy.ts` | Synergy definition schema |
| NEW | `src/lib/db/models/empire/PlayerEmpire.ts` | Player's empire tracking |
| NEW | `src/lib/db/models/empire/ResourceFlow.ts` | Inter-company resource flow |
| NEW | `src/app/api/banking/loans/route.ts` | Loan CRUD operations |
| NEW | `src/app/api/banking/loans/[id]/route.ts` | Single loan operations |
| NEW | `src/app/api/banking/applicants/route.ts` | Applicant generation/listing |
| NEW | `src/app/api/banking/deposits/route.ts` | Deposit management |
| NEW | `src/app/api/empire/synergies/route.ts` | Synergy calculations |
| NEW | `src/app/api/empire/companies/route.ts` | Empire company listing |
| NEW | `src/lib/game/banking/interestCalculator.ts` | Interest math utilities |
| NEW | `src/lib/game/banking/defaultCalculator.ts` | Default probability |
| NEW | `src/lib/game/banking/applicantGenerator.ts` | Random applicant generation |
| NEW | `src/lib/game/empire/synergyEngine.ts` | Synergy calculation logic |
| NEW | `src/app/game/empire/page.tsx` | Empire dashboard page |
| NEW | `src/components/banking/LoanApplicantsPanel.tsx` | Applicant UI |
| NEW | `src/components/banking/ActiveLoansTable.tsx` | Loan management |
| NEW | `src/components/empire/EmpireWeb.tsx` | Visual company web |
| NEW | `src/components/empire/SynergyPanel.tsx` | Active synergies display |

### MODIFY Existing Files:

| Action | Path | Purpose |
|--------|------|---------|
| MOD | `src/lib/db/models/index.ts` | Export new models |
| MOD | `src/lib/api/endpoints.ts` | Add banking/empire endpoints |
| MOD | `src/lib/hooks/useBanking.ts` | Add new banking hooks |
| MOD | `src/components/banking/BankingDashboard.tsx` | Integrate real gameplay |
| MOD | `src/app/game/layout.tsx` | Add Empire nav link |

---

## DEPENDENCIES

- **Game Tick System**: Required for time-based interest/payments (may need to create)
- **Notification System**: For events and alerts (exists partially)
- **Company Model**: Existing company schema (will extend)
- **User Session**: Auth system (exists)

---

## SUCCESS METRICS

| Metric | Target |
|--------|--------|
| **Session Length** | 30+ minutes average |
| **Return Rate** | 60%+ next-day retention |
| **Empire Size** | 3+ industries by level 25 |
| **Synergy Usage** | 80%+ actively pursue synergies |
| **TypeScript** | 0 errors |

---

## THE HOOK

The addiction comes from **exponential growth feeling**:
- One company = linear growth
- Two companies = synergy bonus (faster)
- Three companies = compound synergies (explosion)
- Four+ companies = EMPIRE MODE (unstoppable)

Players will think: *"If I just get ONE more company, my whole empire will be 2x more powerful..."*

That's the "one more turn" compulsion.

---

## NOTES

- This is the FOUNDATION - all other industries will integrate with this system
- Crime MMO (FID-20251204-CRIME-MMO) is PAUSED until this is complete
- Crime will use Banking for money laundering, loans for operations
- Each future industry FID will include its synergy connections

---

*"In the game of empires, the one who controls the money controls the board."*

---

*FID created by ECHO v1.4.0 - Ready for Phase 1 implementation upon approval*
