# FID-20251127-CRIME — Criminal Domain (AAA Planning)

Prepared: 2025-11-27
Owner: Platform Architecture (ECHO v1.3.1)
Status: ✅ COMPLETE
Started: 2025-12-01
Completed: 2025-12-01
Scope: New domain with deep integration to Politics, Business/E-Commerce, Employees

---

## Overview
The Crime domain is a **full MMO-style underworld economy** modeled after "Dope Wars" with deep integration to Politics (legalization, enforcement), Business/E‑Commerce (legitimate front conversion), and Employees (production staff, distribution networks). Players and NPCs run gangs/cartels, control territories, manufacture/distribute drugs, engage in P2P and P2NPC commerce across states with real-world-backed pricing data, and transition to legitimate businesses when substances are federally legalized.

Top goals:
- Create a complete drug trade simulation: manufacturing → distribution → retail → laundering.
- Enable **player-to-player commerce** with state-to-state travel, dynamic pricing, and territory wars.
- Support **gang/cartel operations** (player-owned + NPC) with territory control, supply chains, and reputation.
- Integrate **federal policy** where legalization converts illegal operations into legitimate businesses.
- Provide **MMO social layer**: alliances, betrayals, turf wars, cooperative supply chains.
- Use **real state-level data** for pricing, demand, enforcement intensity, and policy climates.

Reality-based substances policy:
- Use real substance categories and names for market/pricing (e.g., Cannabis, Cocaine, Heroin, Methamphetamine, MDMA, LSD, Psilocybin, Fentanyl, Oxycodone).
- Manufacturing chemistry is abstracted: no real-world synthesis instructions, formulas, or step-by-step guidance.
- Purity/quality represented numerically with fictionalized process variables; avoids instructional content.
- Legalization status and pricing use real-world data sources (SAMHSA, DEA) for baselines.

---

## Core Loops & Integrations

### Primary Economic Loop
1. **Manufacturing**: Build/buy production facilities → Hire employees → Produce substances → Manage quality/yield.
2. **Distribution**: Establish supply routes (state-to-state) → Manage inventory → Negotiate with distributors (player/NPC).
3. **Retail**: Direct sales (P2P marketplace) → Territory-based street sales → Storefront operations (if legalized).
4. **Revenue**: Cash → Laundering (if illegal) → Reinvestment or legitimate conversion.

### Territory & Gang System
- **Territory Control**: Claim city blocks/districts → Generate passive income → Defend from rivals → Expand influence.
- **Gang/Cartel Management**: Recruit members (players + NPCs) → Assign roles → Coordinate operations → Share profits.
- **Turf Wars**: Challenge rival territories → Negotiate peace/alliances → Absorb defeated gangs.

### State-to-State Commerce
- **Travel System**: Players travel between states to buy low/sell high ("Dope Wars" style).
- **Dynamic Pricing**: State-level supply/demand, local enforcement intensity, policy climate, seasonal events.
- **Inter-State Trade**: Bulk purchases from other players' manufacturing ops → Transport risk (seizure/robbery).

### Federal Legalization Pathway
- **Politics Integration**: Players lobby for legalization → Federal bills pass → Substances transition to legal status.
- **Business Conversion**: Illegal operations automatically convert to legitimate businesses (taxed, regulated).
- **Market Shift**: Legal market pricing, competition, quality standards; former criminals become entrepreneurs.

### Cross-Domain Integrations
- **Politics**: Enforcement budgets, DEA priorities, legalization bills, prison sentencing, treatment funding.
- **Business/E‑Commerce**: Legitimate front businesses, supply chain management, retail storefronts (post-legalization).
- **Employees**: Production staff, chemists (quality), drivers (distribution), security, accountants (laundering).
- **Crime → Legitimate**: Tax revenue from legal sales, job creation, reduced enforcement costs.

---

## P0 Feature Set (8 Core + 2 Foundation)

### 1) Drug Manufacturing System
**"Dope Wars" Production Layer**
- **Facility Types**: Labs (synthetics), Farms (plants), Warehouses (storage/packaging).
- **Production Mechanics**: Input materials → Employee skill → Quality/yield/purity → Output inventory.
- **Upgrades**: Equipment tiers (impact yield), security (reduce raid risk), automation (reduce labor).
- **Risk Factors**: Neighbors' suspicion, utility spike detection, chemical odor alerts, employee snitches.
- **Employee Integration**: Hire chemists (quality), laborers (volume), security (protection), managers (efficiency).
- **Real Data**: State-level production costs, chemical precursor availability (DEA watch lists).
  - Use real substance names; abstract production processes (no synthesis guidance).

### 2) Distribution Network
**Supply Chain Management**
- **Routes**: Establish state-to-state pipelines (road/air/rail) with cost/risk/speed trade-offs.
- **Distributors**: NPC wholesalers + player-owned operations; negotiate bulk prices and exclusive deals.
- **Transport**: Hire drivers/mules; vehicle types (capacity vs suspicion); checkpoint risk.
- **Seizure Events**: Random interdictions based on route risk + enforcement intensity; partial/full loss.
- **Inventory Management**: Track stock levels by location; expiration/spoilage for perishables.

### 3) Player-to-Player Marketplace
**MMO Commerce Hub**
- **Listings**: Players post offers (substance, quantity, price, location, purity %).
- **Search/Filter**: By state, substance type, price range, seller reputation, delivery options.
- **Transactions**: Escrow system (prevent scams), meet-up mechanics (in-person = lower risk), shipping (higher risk).
- **Reviews/Reputation**: Buyer/seller ratings, dispute resolution, blacklist/trust networks.
- **Dynamic Pricing**: Real-time state-level supply/demand curves (data-backed by state arrest rates, treatment admissions, seizure data).

### 4) Territory Control & Gang System
**MMO Turf Wars**
- **Territory Map**: City divided into blocks/districts; color-coded by controlling gang.
- **Claiming**: Spend influence to claim unclaimed territory; challenge rivals for contested zones.
- **Income**: Passive revenue from street sales in controlled territory (scales with foot traffic, demographics).
- **Gang/Cartel Creation**: Players found organizations → Recruit members (players + NPCs) → Assign ranks/roles.
- **Alliances**: Form coalitions for mutual defense, shared supply chains, joint operations.
- **Turf Wars**: Initiate challenges → Negotiation or combat resolution → Winner absorbs territory.
- **NPC Gangs**: AI-controlled rivals with scripted behaviors; players can negotiate, bribe, or eliminate.

### 5) State-to-State Travel & Arbitrage
**"Dope Wars" Geographic Gameplay**
- **Travel Interface**: Map view with state nodes; travel costs (time, money, risk).
- **Pricing Variance**: Each state has unique prices based on local supply/demand, enforcement, policy (e.g., weed cheap in CO, expensive in TX).
- **Bulk Buying**: Purchase from player/NPC manufacturers in low-cost states → Transport to high-price states → Sell for profit.
- **Event Modifiers**: Border crackdowns, festivals (demand spikes), droughts (supply drops), policy shifts.
- **Inter-Player Trade**: Players in different states coordinate bulk deals; long-distance trust or escrow.

### 6) Federal Legalization & Business Conversion
**Politics-Driven Market Transformation**
- **Legalization Status**: Track federal + state status per substance (Illegal, Decriminalized, Medical, Recreational).
- **Lobbying**: Players fund campaigns, donate to politicians, influence votes (integrates with Politics domain).
- **Conversion Events**: When legalized federally → Facilities auto-convert to legal businesses (taxed, licensed).
- **Legal Market**: Post-legalization pricing (lower due to competition), quality standards, advertising, retail storefronts.
- **Tax Revenue**: Legal sales generate tax income for Politics domain (treatment programs, enforcement reduction).
- **Former Criminals**: Players transition to legitimate entrepreneurs; criminal records can be expunged via policy.

### 7) Law Enforcement & Heat System
**Risk Management**
- **Heat Levels**: Global, state, city, and personal heat meters.
- **Triggers**: Production volume, transport frequency, territory size, violence, snitches.
- **Enforcement Actions**: Raids (lose facilities/inventory), stings (undercover buys), seizures (routes), investigations (surveillance).
- **Countermeasures**: Bribery, low-profile operations, safehouses, encrypted comms, lookouts.
- **Politics Knobs**: DEA budget, mandatory minimums, treatment vs incarceration, asset forfeiture.

### 8) Money Laundering & Financial Crimes
**Revenue Legitimization**
- **Methods**: Shell companies, cash businesses (car washes, nail salons), crypto mixers, trade-based (art, diamonds).
- **Counterfeit Money**: Produce fake currency → Mix into circulation → Detection risk.
- **Throughput**: Each method has caps, fees, latency, detection probability.
- **Employee Integration**: Hire accountants (reduce detection), lawyers (minimize penalties).
- **AML Counters**: Bank audits, IRS scrutiny, employee whistleblowers, forensic accounting.

### 9) Black Market General Goods (Foundation)
**Beyond Drugs**
- **Categories**: Stolen goods, counterfeits, weapons, restricted items, services (hacking, muscle).
- **Integration**: Uses same marketplace, escrow, reputation systems as drug trade.
- **Heists**: Source inventory via planned robberies (crew, intel, tools).

### 10) Reputation & Underworld Network (Foundation)
**Social Fabric**
- **Factions**: Local gangs, cartels, smuggling rings, hackers, corrupt officials, fences.
- **Reputation**: Earned via successful operations, honored deals, territory control; lost via betrayals, snitching.
- **Benefits**: Better prices, exclusive deals, high-tier suppliers, insider intel, protection.
- **Consequences**: Low rep = higher prices, deal refusals, bounties, faction wars.

---

## P1 Expansion (Additional Features)
- **International Smuggling**: Cross-border routes (Mexico/Canada), customs risk, cartel partnerships.
- **Prison System**: Sentences based on weight/priors, legal defense (reduce time), prison economy (contraband trade), gang recruitment.
- **Informants & Intel**: Plant moles in rival gangs, bribe cops for raid warnings, intercept shipments.
- **Protection Rackets**: Extort businesses in controlled territories, enforce "taxes" on independent dealers.
- **Cybercrime**: Hack enforcement databases (reduce heat), DDoS rival marketplaces, steal identities for fronts.
- **Chemical Synthesis**: Custom drug formulas (risk vs potency), patent analogs (legal gray areas), designer substances.
- **Rehab & Treatment**: Players can pivot to treatment centers (legitimate business post-addiction crisis), politics funding.
- **Asset Forfeiture**: Police seize properties/cash; players challenge in court (legal mini-game).
- **Cartel Alliances**: Form multi-player syndicates, coordinate supply chains across states, pool resources for mega-ops.

---

## Data Models (Mongoose) — Key Fields
Note: Follow GUARDIAN Mongoose Index Rule — one index definition per field. Prefer schema-level compound indexes; avoid duplicate field-level indices.

Common meta fields (all):
- companyId: ObjectId (indexed, tenant key)
- createdAt, updatedAt: Date
- createdBy, updatedBy: ObjectId (ref User)

### Drug Trade Core Models

**ProductionFacility**
- ownerId: ObjectId (ref User/Gang)
- type: (Lab, Farm, Warehouse)
- location: { state, city, address }
- capacity: number (units/day)
- quality: number (0-100, affects purity)
- upgrades: [{ type, level, installed }]
- employees: [{ userId, role, skill }]
- inventory: [{ substance, quantity, purity, batch }]
- suspicionLevel: number (0-100, triggers raids)
- status: (Active, Raided, Abandoned, Seized)
- indexes: { companyId: 1, ownerId: 1, status: 1 }, { location.state: 1, type: 1 }

**Substance**
- name, category: (Stimulant, Depressant, Hallucinogen, Opioid, Cannabis, Synthetic)
- legalStatus: { federal: (Illegal, Decriminalized, Medical, Recreational), stateOverrides: Map<state, status> }
- baseCost: number (production cost)
- marketPrices: Map<state, { buy, sell, lastUpdate }> (real-time state pricing)
- demandFactors: { demographics, season, events }
- riskProfile: { enforcementPriority, penaltyMultiplier, detectionEase }
- indexes: { name: 1 }, { category: 1, legalStatus.federal: 1 }

**DistributionRoute**
- ownerId, facilityId
- origin: { state, city }, destination: { state, city }
- method: (Road, Air, Rail, Courier)
- capacity: number, cost: number, speed: number (hours)
- riskScore: number (seizure probability)
- status: (Active, Suspended, Interdicted)
- shipments: [{ id, quantity, status, eta }]
- indexes: { companyId: 1, ownerId: 1, status: 1 }, { origin.state: 1, destination.state: 1 }

**MarketplaceListing**
- sellerId: ObjectId (ref User/Gang)
- substance, quantity, purity: number
- pricePerUnit, location: { state, city }
- deliveryOptions: [{ method, cost, risk }]
- minOrder, bulkDiscounts: [{ qty, discount }]
- status: (Active, Sold, Expired, Seized)
- sellerRep: number (materialized from transactions)
- indexes: { companyId: 1, status: 1, substance: 1 }, { location.state: 1, pricePerUnit: 1 }

**Transaction**
- buyerId, sellerId, listingId
- substance, quantity, purity, totalPrice
- meetupLocation OR shippingAddress
- escrowStatus: (Pending, Released, Disputed, Refunded)
- deliveryStatus: (Scheduled, InTransit, Delivered, Seized, Lost)
- reviews: { buyerRating, sellerRating, comments }
- indexes: { companyId: 1, buyerId: 1, sellerId: 1 }, { createdAt: -1, escrowStatus: 1 }

### Territory & Gang Models

**Territory**
- territoryId: string (unique block/district ID)
- location: { state, city, district, coordinates }
- controlledBy: ObjectId (ref Gang) OR null
- contestedBy: [ObjectId] (ref Gangs challenging)
- income: number (daily passive revenue)
- population, demographics: { age, income, crimeRate }
- heatLevel: number (local enforcement attention)
- indexes: { territoryId: 1 }, { location.state: 1, location.city: 1, controlledBy: 1 }

**Gang**
- name, tag (abbreviation)
- leaderId: ObjectId (ref User)
- members: [{ userId, rank, joinedAt, role }]
- territories: [ObjectId (ref Territory)]
- reputation: number, factionAlliances: Map<factionId, status>
- bankroll: number (shared funds)
- facilities: [ObjectId (ref ProductionFacility)]
- rivalries: [{ gangId, hostilityLevel, incidents }]
- status: (Active, Disbanded, War)
- indexes: { companyId: 1, leaderId: 1 }, { name: 1 }

**TurfWar**
- challengerGangId, defenderGangId, territoryId
- startedAt, resolvedAt
- method: (Negotiation, Violence, Buyout)
- outcome: (ChallengerWins, DefenderWins, Stalemate, Alliance)
- casualties: [{ userId, status }]
- spoils: { territoryTransfer, cashSettlement }
- indexes: { companyId: 1, territoryId: 1, resolvedAt: -1 }

### Enforcement & Legal Models

**EnforcementEvent**
- type: (Raid, Sting, Seizure, Investigation, Arrest)
- targetType: (Facility, Route, User, Gang)
- targetId: ObjectId
- level: (City, State, Federal)
- location: { state, city }
- heatDelta: number, officers: number
- outcome: { arrests, seizures, injuries }
- relatedIds: [ObjectId] (linked facilities/routes/users)
- indexes: { companyId: 1, createdAt: -1, type: 1 }, { targetId: 1, level: 1 }

**HeatLevel**
- scope: (Global, State, City, User, Gang)
- scopeId: string OR ObjectId
- current: number (0-100)
- factors: [{ source, delta, decay }]
- thresholds: { raid: 80, investigation: 60, surveillance: 40 }
- lastDecay: Date
- indexes: { scope: 1, scopeId: 1 }

**LegislationStatus**
- substance, jurisdiction: (Federal, State)
- jurisdictionId: string (state code if state-level)
- status: (Illegal, Decriminalized, Medical, Recreational)
- effectiveDate, sunsetDate
- penalties: { possession, distribution, manufacturing }
- taxRate: number (if legal), regulations: [string]
- indexes: { substance: 1, jurisdiction: 1, jurisdictionId: 1 }

### Financial Models

**LaunderingChannel**
- ownerId, method: (Shell, CashBiz, Crypto, TradeBased, Counterfeit)
- businessFrontId: ObjectId (ref legitimate business)
- throughputCap: number, feePercent: number
- latencyDays: number, detectionRisk: number
- employeeIds: [ObjectId] (accountants, managers)
- transactionHistory: [{ amount, date, detected }]
- indexes: { companyId: 1, ownerId: 1, method: 1 }, { detectionRisk: -1 }

**CounterfeitOperation**
- ownerId, facilityId
- denomination: number, quality: number (0-100)
- productionRate: number (units/day)
- circulationAmount: number (total in use)
- detectionEvents: [{ date, amount, location }]
- indexes: { companyId: 1, ownerId: 1 }

### Social & Reputation Models

**ReputationLedger**
- userId OR gangId
- factionId OR scope: (Underworld, Law, Public)
- currentRep: number, level: string
- history: [{ delta, reason, source, date }]
- indexes: { userId: 1, factionId: 1 }, { gangId: 1, scope: 1 }, { currentRep: -1 }

**NPCFaction**
- name, type: (Gang, Cartel, Smugglers, Officials, Fences)
- territory: [{ state, city, influence }]
- resources: { cash, inventory, connections }
- personality: { aggression, loyalty, greed }
- relationships: Map<userId OR gangId, standing>
- indexes: { type: 1, territory.state: 1 }

---

## API Surface (REST Patterns)
Base: /api/crime

### Production & Manufacturing
- GET /facilities?ownerId&type&state → list facilities
- POST /facilities → create (buy/build)
- PUT /facilities/:id → upgrade/configure
- POST /facilities/:id/produce → start production batch
- GET /facilities/:id/inventory → stock levels
- DELETE /facilities/:id → abandon/sell

### Distribution & Logistics
- GET /routes?ownerId&origin&destination → list routes
- POST /routes → establish new route
- PUT /routes/:id → modify (capacity, method)
- POST /routes/:id/ship → initiate shipment
- GET /shipments/:id → track delivery status
- GET /shipments/:id/intercept-risk → risk assessment

### Marketplace & Commerce
- GET /marketplace?substance&state&minPurity&maxPrice → search listings
- POST /marketplace → create listing
- PUT /marketplace/:id → update price/quantity
- DELETE /marketplace/:id → cancel listing
- POST /marketplace/:id/buy → initiate purchase (escrow)
- GET /marketplace/prices?substance&states → state price matrix
- GET /marketplace/trends?substance&days → historical pricing

### Transactions & Escrow
- GET /transactions?userId&status → list
- GET /transactions/:id → detail
- POST /transactions/:id/release-escrow → complete deal
- POST /transactions/:id/dispute → open dispute
- POST /transactions/:id/review → submit rating

### Territory & Gangs
- GET /territories?state&city&status → map data
- POST /territories/:id/claim → attempt claim
- POST /territories/:id/challenge → initiate turf war
- GET /gangs?search&state → list
- POST /gangs → create gang/cartel
- PUT /gangs/:id → update (recruit, assign roles)
- POST /gangs/:id/invite → invite player
- POST /gangs/:id/alliance → propose alliance
- GET /gangs/:id/income → revenue breakdown

### Travel & Geography
- POST /travel → move to state (costs time/money)
- GET /travel/routes?from&to → available methods
- GET /travel/player-location → current state/city
- GET /states/:code/market → local pricing/demand

### Enforcement & Heat
- GET /enforcement/events?level&type&state → list
- GET /heat?scope&scopeId → heat levels
- POST /heat/mitigate → lie low, bribery actions
- GET /enforcement/risk-assessment?operation → calculate risk

### Legalization & Policy
- GET /legislation?substance&jurisdiction → status
- POST /legislation/lobby → fund campaign (integrates Politics)
- GET /legislation/bills → active bills in Politics domain
- POST /facilities/:id/convert → convert to legal business (if legalized)

### Money Laundering
- GET /laundering/channels?method → available
- POST /laundering/channels → create front business
- POST /laundering/route → launder funds
- GET /laundering/:id/status → tracking
- POST /counterfeit/produce → make fake currency
- POST /counterfeit/circulate → inject into economy

### Reputation & Social
- GET /reputation?userId&factionId → standings
- GET /reputation/factions → list NPC factions
- POST /reputation/action → gift, betray, honor deal
- GET /npcs?type&location → available NPCs for trade

### Black Market (General)
- GET /black-market?category → non-drug items
- POST /heists/plan → plan robbery (sourcing inventory)
- POST /heists/:id/execute → run heist

Conventions:
- Request validation: Zod schema per route
- Auth: NextAuth session required; role/gang membership checks
- Response envelope: { success, data, error, meta }
- Status codes: 200/201/400/401/403/404/409/422/429/500
- Rate limits: Per-user caps on transactions/day, facility creation, routes
 - Substance catalog: Real names and categories; validation ensures only recognized substances are used in listings and transactions.

---

## Real-Time Events (socket.io)
Namespace: /crime

### Production Events
- event: crime:facility.raided { facilityId, ownerId, seizures, arrests }
- event: crime:batch.completed { facilityId, substance, quantity, purity }
- event: crime:facility.upgraded { facilityId, upgradeType, newCapacity }

### Distribution Events
- event: crime:shipment.started { shipmentId, origin, destination, substance, quantity }
- event: crime:shipment.seized { shipmentId, location, quantity, arrests }
- event: crime:shipment.delivered { shipmentId, destination, quantity }
- event: crime:route.interdicted { routeId, location, losses }

### Marketplace Events
- event: crime:listing.created { listingId, substance, state, pricePerUnit }
- event: crime:listing.sold { listingId, quantity, buyerId, sellerId }
- event: crime:price.changed { substance, state, oldPrice, newPrice, reason }
- event: crime:deal.completed { transactionId, substance, quantity, location }

### Territory Events
- event: crime:territory.claimed { territoryId, gangId, location }
- event: crime:turf-war.started { challengerGang, defenderGang, territoryId }
- event: crime:turf-war.resolved { territoryId, winner, casualties, spoils }
- event: crime:territory.income { territoryId, amount, gangId }

### Gang Events
- event: crime:gang.created { gangId, name, leaderId }
- event: crime:gang.member-joined { gangId, userId, rank }
- event: crime:gang.alliance { gang1, gang2, terms }
- event: crime:gang.war-declared { aggressor, target, reason }

### Enforcement Events
- event: crime:enforcement.raid { targetType, targetId, level, location, outcome }
- event: crime:enforcement.sting { userId, substance, quantity, location }
- event: crime:enforcement.arrest { userId, charges, jurisdiction }
- event: crime:heat.changed { scope, scopeId, oldLevel, newLevel, trigger }

### Legalization Events
- event: crime:legislation.passed { substance, jurisdiction, oldStatus, newStatus }
- event: crime:facility.converted { facilityId, fromType, toBusinessType }
- event: crime:market.legalized { substance, state, newPricing }

### Financial Events
- event: crime:laundering.completed { channelId, amount, fee, detected }
- event: crime:counterfeit.detected { operationId, amount, location, penalties }

### Social Events
- event: crime:reputation.changed { userId, factionId, delta, reason, newLevel }
- event: crime:npc.action { factionId, actionType, target, outcome }

Rate limits: server-side token bucket; per-company + per-user caps.
Fallback: poll GET endpoints with ETag/If-None-Match.
Broadcast scope: Global (major events), State (regional), Gang (members only), Personal (user-specific).

---

## AI‑Lite Insights (no LLM)
- **Risk Advisories**: Compute operation risk scores via rules (heat level, route history, facility suspicion, gang rivalry).
- **Pricing Optimization**: Suggest buy-low states and sell-high states based on real-time price matrix; factor in travel cost and seizure risk.
- **Production Planning**: Recommend substance types based on state demand, legalization trends, and enforcement patterns.
- **Route Recommendations**: Calculate safest/fastest/cheapest routes using weighted scoring (enforcement checkpoints, historical seizures).
- **Heat Forecasting**: Predict raid probability using exponential decay models on current heat + recent activity spikes.
- **Laundering Advice**: Suggest optimal laundering methods based on amount, urgency, and detection risk tolerance.
- **Territory Expansion**: Identify high-value unclaimed territories using demographics, foot traffic, and rival gang positions.
- **Legalization Timing**: Alert when federal bills near passage; recommend preemptive facility upgrades for conversion.
- **Competitive Intelligence**: Track rival gang movements, territory changes, marketplace activity for strategic planning.
- **Monte Carlo Simulations**: Run 1000-iteration simulations for operation outcomes (heists, shipments, turf wars) showing probability distributions.

---

## Engagement Hooks

### Achievements
- **The Basics**: First Facility, First Sale, First Route, First Gang Membership
- **Economic**: $1M Revenue, $10M Empire, Legalization Pioneer (first converted facility)
- **Geographic**: Multistate Operator (facilities in 5+ states), Coast-to-Coast (trade both coasts)
- **Combat**: Turf War Victor, Territory Mogul (10+ territories), Gang Leader
- **Stealth**: Ghost Operator (0 arrests in 30 days), Low Profile (heat never above 50)
- **Social**: Kingpin (reputation 100+), Cartel Boss (gang with 20+ members), Fence Favorite (NPC faction rep 80+)
- **Mastery**: Chemist (90+ purity average), Logistics Guru (100+ successful shipments), Mastermind (5 flawless operations)
- **Political**: Lobbyist (funded 3+ legalization campaigns), Policy Shifter (witnessed federal legalization)

### Leaderboards (Weekly/Monthly/All-Time)
- **Revenue**: Total earnings (illegal + legal combined)
- **Territory**: Most territories controlled
- **Production**: Highest volume produced
- **Trading**: Most profitable P2P transactions
- **Stealth**: Longest arrest-free streak
- **Gang Power**: Largest gang by members and territory
- **Reputation**: Highest underworld standing
- **Arbitrage**: Biggest profit from state-to-state trade

### Live Events
- **Crackdown Weeks**: Heat multipliers (1.5x-2x) for specific states or substance types; higher risk = higher reward.
- **Amnesty Days**: Reduced sentences, heat decay accelerated, good time to convert illegal operations.
- **Festival Seasons**: Demand spikes in specific states (e.g., music festivals, holidays); premium pricing windows.
- **Border Crackdowns**: Checkpoint intensity increases on specific routes; smugglers must adapt.
- **Legislative Sessions**: Real-time Politics votes on legalization bills; players can influence outcomes via lobbying.
- **Supply Shocks**: Droughts, crop failures, or DEA busts create scarcity and price surges for specific substances.
- **Gang Wars**: Server-wide events where major NPC cartels wage war; players choose sides for rewards.
- **Legalization Celebrations**: When substance legalized, temporary bonuses for converted businesses (tax breaks, licensing priority).

### Activity Feed Features
- **Filters**: Personal, Gang, State, Global scopes
- **Reactions**: React to deals, turf wars, busts (emoji-style engagement)
- **Sharing**: Players can share major scores ("Just moved 100kg across 5 states!")
- **Alerts**: Real-time notifications for gang challenges, raid warnings, legalization votes
- **Highlight Reels**: Daily/weekly top events (biggest deal, craziest turf war, boldest escape)

---

## UI/Design System

### Core Components (HeroUI)
- **DataTable**: P2P marketplace listings, facility inventory, gang member rosters, leaderboards
- **Card**: Facility cards, territory cards, gang cards, transaction cards
- **Tabs**: Switch between Production/Distribution/Marketplace/Territory/Heat/Laundering views
- **Modal**: Escrow dispute resolution, turf war initiation, facility upgrade confirmations
- **Tooltip**: Hover for risk scores, purity ratings, heat calculations, reputation details
- **Chip**: Status indicators (Active/Inactive facilities, Pending/Complete transactions, High/Medium/Low risk)
- **Progress**: Production cycle timers, shipment tracking, laundering progress, heat decay
- **Badge**: Notifications for raids, arrests, legalization votes, gang challenges
- **Dropdown**: State selection for travel, substance filtering for marketplace, gang role management

### Charts & Visualizations (Recharts)
- **Line Charts**: Heat over time, reputation trends, pricing by state, production volume history
- **Bar Charts**: Substance demand by state, gang territory counts, weekly revenue comparisons
- **Pie Charts**: Portfolio breakdown (substance types), gang member roles, laundering channel distribution
- **Area Charts**: Profit/loss over time, risk exposure by activity type
- **Scatter Plots**: State pricing vs. enforcement intensity, purity vs. price correlation
- **Heatmaps**: Territory control by gang (geographic visualization), enforcement intensity by state

### Theme Tokens (Crime Domain)
- **Primary Accent**: `crimeViolet` (#8B5CF6 - deep violet for criminal enterprise branding)
- **Risk Indicators**:
  - `riskCritical`: red-600 (90-100 risk score, imminent danger)
  - `riskHigh`: red-500 (70-89 risk, dangerous operations)
  - `riskMedium`: amber-500 (40-69 risk, moderate caution)
  - `riskLow`: emerald-500 (0-39 risk, relatively safe)
- **Status Colors**:
  - `heatCold`: blue-400 (heat 0-30)
  - `heatWarm`: amber-400 (heat 31-70)
  - `heatHot`: red-500 (heat 71-100)
- **Reputation Tiers**:
  - `repNovice`: slate-400 (0-24)
  - `repKnown`: blue-400 (25-49)
  - `repRespected`: purple-400 (50-74)
  - `repKingpin`: gold-500 (75-100)

### Motion & Animations (Framer Motion)
- **Entrance**: Subtle fade-in + slide-up for marketplace listings, facility cards (duration: 200ms, ease: easeOut)
- **Transitions**: Smooth tab switching, modal overlays (duration: 150ms, ease: easeInOut)
- **Success States**: Confetti burst on major deals ($100K+), facility upgrade completions, turf war victories
- **Alert States**: Pulse animation for heat warnings, raid alerts, arrest notifications (pulse: 1s loop, scale: 1.0-1.05)
- **Progress Indicators**: Smooth bar fills for production cycles, laundering progress, shipment tracking (linear easing)
- **Hover Effects**: Lift + shadow on cards (translateY: -2px, shadow increase)
- **Real-Time Updates**: Fade-in for live activity feed items (stagger: 50ms between items)

### Sound Effects (Licensed Free SFX)
- **Actions**:
  - `click.mp3`: Soft click for buttons, tabs (volume: 0.3)
  - `purchase.mp3`: Register chime for completed transactions (volume: 0.4)
  - `upgrade.mp3`: Success tone for facility upgrades (volume: 0.4)
- **Alerts**:
  - `alert.mp3`: Ping for heat warnings, raid notifications (volume: 0.5)
  - `danger.mp3`: Rumble for arrests, failed shipments (volume: 0.5)
  - `victory.mp3`: Triumphant chord for turf war wins, major achievements (volume: 0.6)
- **Ambient**:
  - `market.mp3`: Subtle trading floor ambience for marketplace view (volume: 0.2, loop)
  - `tension.mp3`: Low drone for high heat states (volume: 0.3, loop)
- **Global Settings**: User-controlled volume slider (0-100%), mute toggle

### Specialized UI Elements
- **Risk Meter**: Visual gauge (0-100) with color gradient (green → amber → red) for operation risk scores
- **Heat Display**: Thermometer-style indicator with trigger thresholds marked (50 = warnings, 75 = raids likely, 90+ = imminent)
- **Purity Badge**: Star rating (1-5 stars) based on product purity percentage (60-69% = 2 stars, 90%+ = 5 stars)
- **State Map**: Interactive US map with color-coded states (pricing heatmap, enforcement intensity, legalization status)
- **Gang Roster**: Avatar grid with role badges, online indicators, last activity timestamps
- **Transaction Timeline**: Chronological feed of P2P deals, facility events, territory changes
- **Escrow Widget**: Split-panel view showing buyer/seller perspectives, dispute resolution controls
- **Legalization Tracker**: Progress bars for active bills with vote counts, player lobbying impact visualization

### Responsive Design
- **Desktop** (1920x1080+): Multi-column layouts, split-screen views (map + controls), detailed tables
- **Tablet** (768-1919px): Collapsible sidebars, stacked panels, condensed tables with expand rows
- **Mobile** (< 768px): Single column, bottom sheets for details, swipe gestures for tabs, simplified charts

### Accessibility
- WCAG 2.1 AA compliance (contrast ratios, keyboard navigation, ARIA labels)
- Screen reader support for all interactive elements
- Focus indicators (visible rings on keyboard navigation)
- Reduced motion mode (respects `prefers-reduced-motion`, disables animations)

---

## Manual QA & Sample Data
Checklists per feature include:
- Black Market: create/edit/takedown; riskScore boundaries; sting flag flow.
- Heist Planner: plan/execute edge cases (no crew, max tools, low intel); outcome distributions.
- Heat System: verify deltas per event; decay over time; policy knobs effect.
- Corruption: success/exposure probabilities; effect windows start/expiry.
- Laundering: throughput caps, latency timers, detection outcomes.
- Reputation: faction gating, positive/negative deltas, unlocks.

Sample Loaders:
- `scripts/loaders/crime.seed.ts` creating realistic listings, crews, factions, channels.
- Deterministic seeds for reproducible QA.

---

## Security & Abuse Controls

### Input Validation & Authorization
- **Zod Schemas**: All API routes validate inputs with strict Zod schemas (substance types, quantities, prices, state codes, gang IDs)
- **NextAuth Integration**: Session checks on ALL routes; role-based access for gang operations (founder > officer > member)
- **Gang Membership**: Verify user belongs to gang before territory operations, distribution route access, gang treasury withdrawals
- **Ownership Checks**: Verify user owns facility before production/upgrades, owns listing before edits/deletes, owns territory before transfers
- **State Validation**: Ensure state codes are valid US states (50 states + DC), reject international locations (reserved for P1)
 - **Substance Catalog Validation**: Only allow predefined real substance names/categories; reject unknown/fake names.

### Rate Limits (Per-User, Rolling Window)
- **Production**: Start production max 10 times/hour (prevents rapid-fire facility spam)
- **Distribution**: Create route max 20 times/hour (prevents route flooding)
- **Marketplace**: Create listing max 30/day, purchase max 50/day (prevents market manipulation)
- **Transactions**: Initiate escrow max 100/day (prevents payment processing abuse)
- **Territory**: Claim territory max 5/day, initiate turf war max 3/day (prevents spam challenges)
- **Travel**: Change state max 20/day (prevents unrealistic teleportation)
- **Laundering**: Initiate laundering max 10/day per channel (prevents rapid cycling)
- **Counterfeit**: Produce counterfeit max 5/day (prevents flooding economy)
- **Black Market**: Purchase max 15/day (prevents stockpiling exploits)

### Server-Side Validation (Anti-Cheat)
- **Calculations**: All risk scores, purity, yield, heat, reputation calculated server-side (client cannot manipulate)
- **Outcomes**: Production results, shipment success/failure, turf war winners, arrest probabilities determined by server RNG with auditable seeds
- **Escrow**: Funds locked server-side; buyer cannot double-spend, seller cannot withdraw until release conditions met
- **Inventory**: Server-authoritative inventory; client cannot add/remove items directly, all changes via API with validation
- **Pricing**: Server enforces minimum/maximum bounds based on state data; reject unrealistic prices (< $1 or > $1M per unit)
- **Territory Ownership**: Server maintains single source of truth; gang cannot claim already-owned territory, ownership transfers atomic
- **Heat Decay**: Server-side cron job (not client-triggered); prevents manual heat manipulation
- **Legalization**: Server-controlled conversion; client cannot trigger facility conversion without actual Politics bill passage

### Audit Logging
- **Sensitive Actions**: Log all bribes (who, amount, target official), enforcement overrides (admin actions), territory transfers (gang, territory, timestamp)
- **Financial**: Log all transactions > $10K (buyer, seller, amount, substance, state), laundering operations (channel, amount, success), counterfeit production (user, quantity, quality)
- **Gang Activity**: Log turf war initiations/resolutions (challenger, defender, territory, outcome), gang creations/dissolutions (founder, timestamp), member role changes (who changed, who was changed, old/new role)
- **Legalization**: Log facility conversions (facility, substance, pre/post revenue), inventory transfers (substance, quantity, value)
- **Retention**: Audit logs retained 90 days minimum, anonymized after 180 days, deleted after 365 days

### Anti-Abuse Mechanisms
- **Duplicate Transaction Prevention**: Escrow ID is UUID; server checks for duplicate escrow attempts with same buyer/seller/listing within 1 minute window
- **Market Manipulation Detection**: Flag users creating >10 listings for same substance in same state within 1 hour (potential price fixing)
- **Unrealistic Profit Flags**: Alert admins if user accumulates > $1M in < 24 hours (investigate for exploits)
- **Gang Collusion**: Monitor gangs that never fight each other but control adjacent territories (potential coordinated avoidance)
- **Counterfeit Flooding**: If >100 counterfeit bills circulate from single user in 7 days, auto-flag for review
- **Facility Spam**: Limit max facilities per user to 50 (prevents database bloat)
- **Gang Size Limits**: Max 100 members per gang (prevents mega-gang monopolies)
- **Territory Caps**: Max 30 territories per gang (prevents total map control)

### Data Privacy & Compliance
- **PII Minimization**: Do NOT store real names, addresses, financial details in Crime domain; use pseudonymous userIds
- **Pseudonymization**: Display usernames only (not emails); gang member lists show usernames, not personal data
- **Sensitive Data Encryption**: Encrypt audit logs at rest (AES-256); encrypt financial transaction details (amount, counterparty)
- **GDPR Compliance**: Users can request data export (all facilities, transactions, gang memberships as JSON); data deletion removes user from gangs, nullifies gang-owned territories transfer to server
- **COPPA Compliance**: Age gate (13+ required); under-18 users restricted from certain high-risk features if legally required
 - **Crime Domain Age Gate & Disclaimers**: Crime pages display fiction disclaimers and require age confirmation before access. Reality-based names are used; chemistry is abstracted.

### Real-Time Event Security
- **Broadcast Scope Validation**: Server verifies user has permission to receive event (gang member for gang events, state resident for state events, global for all users)
- **Signed Payloads**: Critical events (legalization, raid alerts, turf war outcomes) include HMAC signature; client verifies authenticity
- **Rate Limit Broadcasting**: Max 100 events/user/minute (prevents event spam attacks)
- **Client Spoofing Prevention**: Server ignores client-emitted events for critical flows (cannot fake production completion, cannot forge transaction approval)

### Admin Controls & Moderation
- **Admin Dashboard**: View flagged users, high-risk transactions, unusual patterns
- **Manual Override**: Admins can cancel suspicious escrows, void fraudulent transactions, disband abusive gangs
- **Ban System**: Temporary (7-day, 30-day) or permanent bans for ToS violations (cheating, harassment, exploits)
- **Rollback Capability**: Database snapshots every 6 hours; can rollback exploited transactions if detected within 24 hours
- **Emergency Kill Switch**: Disable Crime domain entirely if critical exploit discovered (preserve data, block all API routes until patched)

### Penetration Testing Scenarios
- **Escrow Double-Spend**: Attempt to purchase with insufficient funds, release funds before transfer completes
- **Inventory Duplication**: Attempt to create facility with negative costs, duplicate substances via concurrent API calls
- **Heat Manipulation**: Attempt to manually trigger heat decay via API spam, forge low heat values for high-risk operations
- **Gang Permission Bypass**: Attempt to claim territory without gang membership, withdraw from gang treasury without officer role
- **Legalization Bypass**: Attempt to trigger facility conversion without actual Politics bill passage
- **Rate Limit Evasion**: Attempt distributed requests from multiple IPs, session token reuse
- **SQL Injection**: Attempt malicious inputs in substance names, gang names, listing descriptions (mitigated by Mongoose + Zod validation)

---

## Dependencies & Integrations

### Politics Domain (Deep Integration)
- **Enforcement Budgets**: DEA/state police funding affects raid frequency, heat decay rates.
- **Legalization Bills**: Players lobby via Politics → Federal/state bills pass → Crime systems react (facility conversion, pricing shifts).
- **Sentencing Policy**: Mandatory minimums, three strikes, treatment vs incarceration affect player risk calculations.
- **Asset Forfeiture**: Police can seize facilities/cash; contested via Politics legal system.
- **Tax Revenue**: Legal substance sales generate tax income for Politics budgets (treatment, education).

### Business/E-Commerce Domain
- **Legitimate Fronts**: Players create legal businesses for laundering; post-legalization, crime ops become real businesses.
- **Supply Chain**: Legal businesses source from player-owned production (post-legalization).
- **Retail Storefronts**: Dispensaries, smoke shops replace street dealers when substances legalized.
- **Counterfeit Goods**: Black market integrates with e-commerce for stolen/fake merchandise.

### Employees Domain
- **Production Staff**: Hire chemists (purity), laborers (volume), security (raid defense), drivers (distribution).
- **Skill Impact**: Employee skills directly affect production yields, transport success, heat mitigation.
- **Insider Risk**: Employees can snitch (trigger raids), steal inventory, leak to rivals.
- **AML Training**: Accountants with training reduce laundering detection risk.
- **Whistleblowers**: Disgruntled employees report to authorities (enforcement events).

### Shared Infrastructure
- **GamificationEngine**: Achievements (First Lab, Kingpin Status, Ghost Operations, Cartel Boss).
- **LiveActivityFeed**: Real-time crime events (turf wars, major busts, legalization votes, record deals).
- **AIInsightsPanel**: Risk forecasts, optimal routes, pricing recommendations, heat predictions.
- **NotificationCenter**: Alerts for raids, shipment arrivals, turf challenges, legalization votes.
- **GeographyService**: State-level data (pricing, demand, enforcement, demographics) from real datasets.

### External Data Integration
- **State Pricing**: Based on real arrest rates, treatment admissions, seizure data (SAMHSA, DEA).
- **Demographics**: Age, income, urban density affect territory income and demand.
- **Enforcement Intensity**: Historical data informs base heat levels and raid probabilities per state.
- **Legalization Status**: Real-world medical/recreational status as baseline; Politics domain can diverge.

---

## Estimates (Revised P0 with MMO Drug Trade)
- Drug Manufacturing System: 14–18h (8–10 endpoints + production logic)
- Distribution Network: 12–16h (7–9 endpoints + route optimization)
- Player-to-Player Marketplace: 16–20h (10–12 endpoints + escrow + real-time pricing)
- Territory Control & Gang System: 18–22h (12–15 endpoints + turf war mechanics)
- State-to-State Travel & Arbitrage: 10–12h (5–7 endpoints + state data integration)
- Federal Legalization & Conversion: 12–14h (6–8 endpoints + Politics integration)
- Law Enforcement & Heat: 10–12h (6–8 endpoints + risk calculations)
- Money Laundering & Counterfeit: 10–12h (6–8 endpoints)
- Black Market General: 8–10h (5–7 endpoints)
- Reputation & Network: 8–10h (5–7 endpoints)

**Total P0: 118–146h** (+ shared UI/utilities 12–16h, state data integration 8–10h)
**Grand Total: 138–172h**

Note: This is a MAJOR expansion from original 47–59h estimate due to MMO complexity (P2P commerce, territory wars, multi-state systems, legalization). Recommend phasing:
- **P0-Alpha (60–70h)**: Manufacturing, Distribution, Marketplace, Heat, Laundering (core economic loop)
- **P0-Beta (50–60h)**: Territory, Gangs, Travel, Reputation (MMO social layer)
- **P0-Gamma (28–42h)**: Legalization, Conversion, Black Market, Polish (integration + unique features)

---

## Success Metrics
- Engagement: +25% session time via real-time events.
- Retention: +15% week-2 return with achievements/leaderboards.
- Balance: heist success rate 40–60% median; laundering detection 5–20% depending on policy.
- Performance: <200ms API p95; <3s page load; socket event <100ms propagation in dev.

---

## Risks & Mitigations

### Scope & Complexity Risks
- **Risk**: MMO drug trade economy is 3x original estimate (138-172h vs. 47-59h); could balloon further
- **Mitigation**: 
  - Phased approach (P0-Alpha/Beta/Gamma) with clear deliverables per phase
  - Alpha = core economic loop (manufacturing, distribution, P2P marketplace) playable in isolation
  - Beta = MMO social layer (gangs, territory, turf wars) adds multiplayer depth
  - Gamma = integration + unique features (legalization, state travel, counterfeit) completes vision
  - Each phase can ship independently; user gets value at every checkpoint

- **Risk**: Feature creep from user enthusiasm ("all of it ties together"); endless integration possibilities
- **Mitigation**: 
  - Lock P0 features to 10 systems defined in this FID
  - Create P1 backlog for International Smuggling, Prison System, Informants, etc.
  - Require explicit approval to add P0 features beyond current scope
  - Timebox each feature (Manufacturing 14-18h max; if exceeds, cut to P1)

### Ethical & Legal Risks
- **Risk**: Game simulates illegal drug trade; could attract negative media attention, legal scrutiny, or platform bans
- **Mitigation**: 
  - Clear fiction disclaimers on all Crime domain pages ("This is a game simulation with no real-world applicability")
  - No real-world drug production guidance (abstract chemistry, no actual synthesis instructions)
  - No glorification of violence or criminal activity (consequences modeled: arrests, heat, asset forfeiture)
  - Educational framing: "Explore economic systems, risk management, and policy impacts in a safe environment"
  - Age gate (18+ recommended for Crime domain access)
  - Consult legal counsel before launch regarding gambling/vice game regulations

- **Risk**: Users could use platform for actual criminal coordination (code words, meet-ups)
- **Mitigation**: 
  - Monitor gang chat for ToS violations (no real-world coordination allowed)
  - Automated keyword flagging for suspicious patterns
  - Report feature for users to flag inappropriate content
  - Immediate ban for users attempting real-world criminal activity coordination

### Technical & Performance Risks
- **Risk**: 60+ API endpoints create maintenance burden; regression risk on every change
- **Mitigation**: 
  - Comprehensive automated testing (API integration tests for all routes)
  - Shared validation schemas (Zod types reused across routes)
  - Modular route structure (`/api/crime/production/`, `/api/crime/marketplace/`, etc.)
  - Documentation auto-generated from Zod schemas (OpenAPI spec)

- **Risk**: Real-time events (25+ types) could overload Socket.io server at scale (10K+ concurrent users)
- **Mitigation**: 
  - Rate limit broadcasting (max 100 events/user/minute)
  - Backpressure mechanisms (drop low-priority events if queue > 1000)
  - Fallback to polling for non-critical updates (marketplace listings, pricing)
  - Horizontal scaling via Railway/Render with sticky sessions
  - Redis pub/sub for multi-instance event distribution
  - Monitor event queue depth; alert if > 500 sustained

- **Risk**: State-level pricing data (50 states × 10+ substances = 500+ data points) could become stale or inaccurate
- **Mitigation**: 
  - Quarterly data refresh from SAMHSA, DEA sources
  - Fallback to national averages if state data missing
  - Manual override capability for admins to adjust pricing
  - User-reported data quality issues (flagging system)

### Economic & Balance Risks
- **Risk**: P2P marketplace could be exploited for money laundering between alt accounts (transfer wealth without risk)
- **Mitigation**: 
  - Escrow fees (5-10% on all transactions) make simple transfers expensive
  - Transaction limits (max $100K/day per user for new accounts, $500K/day for established)
  - Flag suspicious patterns (same buyer/seller repeatedly, round-number transfers)
  - Reputation decay on cancellations/disputes (prevents throwaway accounts)

- **Risk**: Legalization pathway could crash illegal market economy (prices plummet, players lose assets)
- **Mitigation**: 
  - Gradual legalization (substance-by-substance, state-by-state, not all at once)
  - Automatic facility conversion preserves player investments (illegal → legal seamlessly)
  - Black market persists for non-legalized substances (diversified portfolios insulated)
  - Tax benefits for early adopters (converted facilities get 6-month tax break)
  - Player lobbying can delay legalization (Politics integration gives players control)

- **Risk**: Territory wars could lead to gang monopolies (dominant gang claims all territories, no competition)
- **Mitigation**: 
  - Territory cap (max 30 per gang) prevents total map control
  - Passive income scales sublinearly (diminishing returns after 10 territories)
  - NPC factions challenge top gangs (server-controlled competition)
  - Turf war cooldowns (14 days after loss before re-challenge)
  - Alliance limits (max 3 allied gangs) prevent mega-coalitions

### Data Integrity & Exploit Risks
- **Risk**: Inventory duplication via concurrent API calls (race condition)
- **Mitigation**: 
  - Optimistic locking (version field on inventory documents)
  - Database transactions for multi-step operations (deduct funds + add inventory atomically)
  - Idempotency keys on production/purchase endpoints (retry safety)

- **Risk**: Counterfeit money could flood economy if production unchecked
- **Mitigation**: 
  - Rate limits (max 5 counterfeit operations/day)
  - Detection risk scales with circulation (>100 bills from one user = 90% detection)
  - Asset forfeiture on detection (lose ALL counterfeit + 50% legitimate funds)
  - NPC economy rejects low-quality counterfeit automatically

- **Risk**: Gang founder could steal treasury and abandon gang
- **Mitigation**: 
  - Withdrawal limits for founders (max 25% treasury/week)
  - Multi-sig for large withdrawals (requires 2+ officers to approve >$100K)
  - Audit log visible to all gang members (transparency)
  - Democratic overthrow (members can vote to remove founder if >75% agree)

### Integration & Dependency Risks
- **Risk**: Politics domain legalization bills don't sync properly with Crime domain (timing mismatch)
- **Mitigation**: 
  - Webhook from Politics to Crime on bill passage (instant notification)
  - Polling fallback (Crime checks Politics every 5 minutes for new laws)
  - Grace period (24h delay between bill passage and facility conversion for player preparation)

- **Risk**: Employees domain staff assignments fail due to schema mismatches
- **Mitigation**: 
  - Shared types package (`@simgov/shared-types`) with Employee, Skill interfaces
  - Integration tests between domains (hire employee → assign to facility → verify skills apply)
  - Fallback to generic staff if Employees domain unavailable (degraded mode, no skill bonuses)

- **Risk**: External data sources (SAMHSA, DEA) change formats or go offline
- **Mitigation**: 
  - Cache last-known-good data (90-day fallback)
  - Manual upload capability for admins (CSV import)
  - National averages as ultimate fallback (state data optional)

### User Experience & Engagement Risks
- **Risk**: Complexity overwhelms new players (60+ endpoints, 10 features, steep learning curve)
- **Mitigation**: 
  - Interactive tutorial (10-15 min guided experience)
  - Starter quests (first facility, first sale, first territory = rewards)
  - Progressive unlock (start with 2-3 features, unlock rest via achievements)
  - Help tooltips on every major UI element
  - Video walkthrough (3-5 min overview)

- **Risk**: Players frustrated by arrests, raids, asset forfeiture (lose progress)
- **Mitigation**: 
  - Clear risk indicators BEFORE actions (show heat, probability, consequences)
  - Insurance system (pay 10% premium to protect 50% assets on arrest)
  - Bankruptcy protection (first arrest forgives 50% fines for new players)
  - Heat decay visible (show exact time until heat drops below risk threshold)

- **Risk**: Solo players feel disadvantaged vs. gang members (can't compete for territories)
- **Mitigation**: 
  - Solo-friendly features (P2P marketplace, state travel, laundering work without gang)
  - NPC factions offer solo players alliance benefits (protection, access to routes)
  - Achievements for solo play ("Lone Wolf" for 90 days without gang)
  - Territory system optional (core economic loop (production/distribution/P2P) works without territories)

---

## Manual QA Checklist

### Production & Manufacturing
- [ ] Create facility (all types: Lab, Farm, Distribution Center, Warehouse)
- [ ] Assign employees to facility (verify skill matching and efficiency calculations)
- [ ] Upgrade facility (equipment, security, capacity)
- [ ] Production cycles complete correctly (verify timing, purity calculations, yield)
- [ ] Facility raids handled (inventory loss, downtime, heat increase)
- [ ] Facility conversion on legalization (verify instant conversion, pricing/tax changes, employee retention)

### Distribution & Logistics
- [ ] Create distribution route (verify distance calculations, state crossing detection)
- [ ] Assign drivers/couriers (verify skill matching, risk assessment)
- [ ] Shipment departs and tracks progress (real-time status updates)
- [ ] Interception events trigger correctly (heat threshold, enforcement probability)
- [ ] Successful deliveries (inventory transferred, reputation updated)
- [ ] Failed deliveries (product confiscated, drivers arrested, gang reputation impact)

### P2P Marketplace & Transactions
- [ ] Create marketplace listing (all substance types, state-specific pricing)
- [ ] Browse listings with filters (state, substance, price range, seller reputation)
- [ ] Purchase from another player (escrow created, funds locked)
- [ ] Complete transaction (product transferred, escrow released, both parties receive reputation)
- [ ] Dispute transaction (escrow held, admin/system review)
- [ ] Review system (leave rating, view seller history)
- [ ] Suspicious activity flagged (rapid transactions, underpriced goods)

### State-to-State Travel & Arbitrage
- [ ] View state pricing (verify real data integration, demand/supply factors)
- [ ] Travel to different state (inventory moved, heat persists or decays)
- [ ] Purchase cheap in State A, sell high in State B (verify profit calculation)
- [ ] Checkpoint encounters (random checks, heat-based probability)
- [ ] Border crossing events (contraband search, bribery option, arrest possibility)

### Territory & Gang System
- [ ] Claim territory (initial claim, verify territory data creation)
- [ ] Join gang (member permissions, access to gang territories)
- [ ] Create gang (founder role, full permissions)
- [ ] Turf war initiation (challenge rival gang for territory)
- [ ] Turf war resolution (victory = territory transfer, loss = reputation damage)
- [ ] Gang member permissions (verify role-based access: founder > officer > member)
- [ ] Passive income from territories (daily payouts, gang treasury)
- [ ] NPC faction interactions (alliances, conflicts, reputation impacts)

### Law Enforcement & Heat System
- [ ] Heat accumulates from production, distribution, P2P sales (verify calculations)
- [ ] Heat decays over time (verify decay rates: 0.5-1 per day baseline)
- [ ] High heat triggers raids (facility inspections, product confiscation)
- [ ] Arrests occur (verify sentencing, fines, heat spikes)
- [ ] Enforcement intensity varies by state (verify real data integration)
- [ ] Heat forecasting works (AI-Lite predictions accurate)

### Federal Legalization & Business Conversion
- [ ] Legalization bill passes (verify Politics integration, real-time notification)
- [ ] Facility converts to legitimate business (instant conversion, inventory remains)
- [ ] Pricing shifts (illegal markup removed, taxes applied)
- [ ] Distribution routes become legal shipments (heat removed, enforcement stops)
- [ ] Employee status transitions (illegal → legal staff, compliance training)
- [ ] Tax integration (verify Politics domain receives revenue data)

### Money Laundering & Counterfeit
- [ ] Create laundering channel (all types: Casino, RealEstate, Business, Crypto)
- [ ] Launder funds (verify conversion rate, fees, success probability)
- [ ] AML flags trigger (high volumes, rapid movements)
- [ ] Counterfeit production (verify quality, detection risk)
- [ ] Counterfeit circulation (verify acceptance by NPCs, player detection)
- [ ] Asset forfeiture on detection (funds seized, reputation damage)

### Black Market (General)
- [ ] Browse black market items (illegal goods, counterfeit currency, tools)
- [ ] Purchase black market item (escrow, delivery, quality verification)
- [ ] Sell to black market (NPC buyers, price negotiation)
- [ ] Insider access unlocks (reputation thresholds, exclusive listings)

### Reputation & Social Network
- [ ] Reputation increases (successful deals, territory control, gang activity)
- [ ] Reputation decreases (failed shipments, arrests, gang defeats)
- [ ] NPC faction relationships (positive/negative shifts based on actions)
- [ ] Access tiers unlock (reputation 50+ for premium routes, 80+ for NPC alliances)
- [ ] Competitive intelligence (view rival gang stats, pricing trends)

### Real-Time Events & Notifications
- [ ] Production events broadcast correctly (gang scope for members, personal for owner)
- [ ] Territory events broadcast to affected gangs and state
- [ ] Marketplace events broadcast globally (new listings, major sales)
- [ ] Enforcement events broadcast to affected players and state
- [ ] Legalization events broadcast globally (policy changes, conversion notifications)
- [ ] Notification delivery (in-app alerts, email summaries, push if enabled)

### Cross-Domain Integration
- [ ] Politics: Legalization bills visible in Crime domain (voting impacts, enforcement budget changes)
- [ ] Business: Legitimate fronts accessible from Crime (post-legalization conversion seamless)
- [ ] Employees: Production staff hired from Employees domain (skills apply, insider risk flags)
- [ ] Geography: State-level data accurate (pricing, demand, enforcement from real sources)

### Performance & Edge Cases
- [ ] Large gang operations (100+ members, 50+ territories)
- [ ] High-frequency trading (100+ P2P transactions per day)
- [ ] Multi-state operations (facilities in 10+ states, routes across country)
- [ ] Concurrent turf wars (multiple gangs fighting simultaneously)
- [ ] Legalization cascade (3+ substances legalized in quick succession)
- [ ] Market manipulation attempts (price fixing, cornering supply)

### Security & Anti-Cheat
- [ ] Rate limits enforced (production, distribution, P2P transactions)
- [ ] Unrealistic profits flagged (impossibly fast accumulation)
- [ ] Duplicate transactions prevented (escrow double-spend protection)
- [ ] Role-based access enforced (gang permissions, territory ownership)
- [ ] Real-time event authenticity (verify server-side validation, no client spoofing)

---

## Acceptance Criteria (P0)
- All routes with Zod validation and strict TypeScript types.
- Socket.io namespace `/crime` broadcasting key events with rate limits.
- HeroUI-first UI with responsive layouts, accessible controls.
- Mongoose schemas with non-duplicated indexes (GUARDIAN rule #17).
- Manual QA checklists executed (see above comprehensive list); sample data loaders produce stable datasets.
- Docs updated in Roadmap + Final Presentation to reflect Crime domain.

