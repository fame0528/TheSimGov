# FID-20251205-004: ECHO Compliance Phase 2B - Energy Domain Type Safety

**Status:** PLANNED
**Priority:** P2 (Medium)
**Complexity:** 4
**Estimated:** 3-4h
**Created:** 2025-12-05
**Started:** 
**Completed:** 

## Summary
Remove ~75 `as any` type assertions from Energy domain API routes. This requires updating Mongoose model interfaces to include missing fields (dailyProduction, currentOutput, ratedCapacity, nameplateCapacity, etc.).

## Context
Phase 2A (FID-20251205-003) removed 21 `as any` instances from priority routes. Energy domain was deferred due to scope - it requires model interface updates before route fixes can be applied.

## Acceptance Criteria
- [ ] All `as any` removed from Energy API routes
- [ ] Energy model interfaces updated with proper field types
- [ ] TypeScript: 0 errors
- [ ] Tests remain green

## Target Files

### API Routes (~75 instances)
| File | Approx. Count |
|------|---------------|
| `src/app/api/energy/forecasting/demand/route.ts` | 6 |
| `src/app/api/energy/forecasting/generation/route.ts` | 16 |
| `src/app/api/energy/analytics/generation/route.ts` | 18 |
| `src/app/api/energy/analytics/performance/route.ts` | 30 |
| `src/app/api/energy/reserves/route.ts` | 5 |
| `src/app/api/energy/subsidies/route.ts` | 6 |
| `src/app/api/energy/storage/[id]/charge/route.ts` | 4 |
| `src/app/api/energy/storage/[id]/discharge/route.ts` | 4 |
| `src/app/api/energy/compliance/emissions/route.ts` | 5 |
| `src/app/api/energy/power-plants/[id]/dispatch/route.ts` | 2 |
| `src/app/api/energy/transmission-lines/[id]/upgrade/route.ts` | 1 |
| `src/app/api/energy/extraction-sites/route.ts` | 1 |
| `src/app/api/energy/orders/[id]/route.ts` | 3 |

### Model Interfaces Requiring Updates
| Model | Missing Fields |
|-------|----------------|
| OilWell | dailyProduction, productionRate, currentOutput |
| GasField | dailyProduction, reserveEstimate, productionRate |
| SolarFarm | dailyProduction, nameplateCapacity, ratedCapacity, currentOutput, installationCost |
| WindTurbine | dailyProduction, ratedCapacity, nameplateCapacity, currentOutput, installationCost |
| PowerPlant | currentOutput, nameplateCapacity, plantType, dispatchMode |
| EnergyStorage | stateOfCharge, isCharging, isDischarging, batteryHealth |
| TransmissionLine | currentLoad, capacity, voltageLevel |

## Implementation Approach
1. Read all Energy model files completely
2. Identify common fields across routes
3. Update model interfaces with missing field definitions
4. Update routes to use properly typed fields
5. Run TypeScript verification
6. Run tests

## Dependencies
- FID-20251205-003 (Phase 2A) - COMPLETED

## Notes
- Many fields may already exist in schemas but not in TypeScript interfaces
- Some fields may need sensible defaults added
- Pattern discovery from existing Energy models recommended before starting

---
*Created by ECHO v1.4.0*
