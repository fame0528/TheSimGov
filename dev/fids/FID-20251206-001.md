# FID-20251206-001: Core Loop UI (Treasury Bar, Notifications, Revenue Ticker)

**Status:** PLANNED  
**Priority:** P0 (Critical for Game Feel)  
**Complexity:** High  
**Estimated Hours:** 16h  
**Created:** 2025-12-06  
**Dependencies:** None  
**FID:** FID-20251206-001

## üéØ Summary

Implement the **Core Loop UI** components that make the game "feel" like a game. This is the most critical phase for player engagement - without visible money flow and feedback, players won't understand what's happening or feel motivated to continue.

## üéÆ Business Value

The game currently has extensive backend infrastructure but lacks the **"game feel"** that creates engagement. Players need to see:
- Money accumulating in real-time
- Notifications when things happen
- Clear feedback for their actions
- Progress indicators

This phase transforms the game from a "business simulator" into an **engaging business MMO**.

## üìã Acceptance Criteria

### ‚úÖ Treasury Bar (Fixed Header)
- [ ] Fixed header component showing current treasury balance
- [ ] Real-time updates every 5 seconds
- [ ] Formatted currency display ($1.2M, $45.6K, etc.)
- [ ] Responsive design (mobile-friendly)
- [ ] Consistent across all dashboard pages

### ‚úÖ Revenue Ticker Animation
- [ ] Animated counter showing money accumulating
- [ ] Updates every 1-2 seconds with smooth animation
- [ ] Shows revenue rate (e.g., "+$2,340/min")
- [ ] Different colors for positive/negative flow
- [ ] Pauses during offline periods

### ‚úÖ Toast Notification System
- [ ] HeroUI toast integration
- [ ] Event notifications ("Loan payment received: +$45,000")
- [ ] Achievement notifications ("Level up! Banking Level 3")
- [ ] Error notifications ("Transaction failed")
- [ ] Success notifications ("Company acquired successfully")

### ‚úÖ Offline Progress Screen
- [ ] "While you were away..." modal on login
- [ ] Shows ticks processed, revenue earned, events occurred
- [ ] Summary statistics (total revenue, companies processed)
- [ ] Event highlights (important things that happened)
- [ ] Dismissible with "Continue" button

### ‚úÖ Sound Effects Integration
- [ ] Ka-ching sound for revenue events
- [ ] Level-up jingle for achievements
- [ ] Alert sound for important notifications
- [ ] Volume controls in settings
- [ ] Respect user audio preferences

## üèóÔ∏è Implementation Approach

### Phase 1: Treasury Bar (4 hours)
1. Create `TreasuryBar` component with fixed positioning
2. Connect to treasury data via SWR
3. Add currency formatting utility
4. Implement responsive design
5. Add to main layout

### Phase 2: Revenue Ticker (3 hours)
1. Create `RevenueTicker` component with animation
2. Calculate revenue rate from recent transactions
3. Implement smooth counter animation
4. Add color coding (green/red)
5. Integrate with TreasuryBar

### Phase 3: Toast System (3 hours)
1. Set up HeroUI toast provider
2. Create notification utility functions
3. Add toast triggers to key events
4. Style different notification types
5. Add sound integration

### Phase 4: Offline Progress (4 hours)
1. Create `OfflineProgress` modal component
2. Calculate offline ticks and revenue
3. Fetch recent events during offline period
4. Display summary with key metrics
5. Add to login flow

### Phase 5: Sound Effects (2 hours)
1. Set up audio utility with Howler.js
2. Add sound files to public directory
3. Integrate sounds with notification system
4. Add volume controls to settings

## üìÅ Files to Create

### Components
- `src/components/core/TreasuryBar.tsx`
- `src/components/core/RevenueTicker.tsx`
- `src/components/core/NotificationSystem.tsx`
- `src/components/core/OfflineProgress.tsx`

### Utilities
- `src/lib/utils/audio.ts`
- `src/lib/utils/currency.ts` (enhance existing)

### API Routes (if needed)
- `src/app/api/user/offline-progress/route.ts`

## üîó Dependencies

- HeroUI (already installed)
- Framer Motion (already installed)
- Howler.js (already installed)
- React Query/SWR (already installed)

## üéØ Quality Standards

- **AAA Quality**: Production-ready components with error handling
- **Performance**: Efficient re-renders, no memory leaks
- **Accessibility**: Screen reader support, keyboard navigation
- **Mobile**: Responsive design for all screen sizes
- **TypeScript**: Full type safety, no `any` types

## üìä Success Metrics

- **User Engagement**: Increased session time by 2x
- **Retention**: 40% day-2 retention (vs current ~10%)
- **Feedback**: Users report "feeling" the money flow
- **Technical**: 0 performance issues, smooth animations

## üö® Risk Mitigation

- **Performance**: Use `useMemo` for expensive calculations
- **Audio**: Check user preferences before playing sounds
- **Offline**: Handle edge cases (long offline periods, errors)
- **Real-time**: Implement proper cleanup on component unmount

## üìà Expected Impact

This phase transforms the game from a "business management tool" into an **engaging business MMO**. Players will finally see and feel their empire growing, creating the motivation to keep playing and expanding.

**Without this phase:** Game feels like a spreadsheet - players don't understand what's happening
**With this phase:** Game feels like a living, breathing business empire that responds to their actions